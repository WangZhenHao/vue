<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="../dist/vue.js"></script>
</head>
<body>
	<div id="app">
		 <test></test>{{ msg }}
	</div>
	<script>
		/**
		  vue父子组件通信原理
      
      1: 如果在组件添加一个事件，入<test @to-input="toInputHandle"></test>
      它在编译成vnode之前，会执行createComponent函数，把data.on里面的对象
      放到listeners，vnode对象里面就有一个listeners属性了
      1-1： 当触发事件的时候，就会执行updataChildComponent函数，最后把赋值vm.$listeners = listeners
      1-2： 
      
		 	(function anonymous() {
			    with(this) {
			        return _c('div', {
			            attrs: {
			                "id": "app"
			            }
			        },
			        [_c('test', {
			            on: {
			                "to-input": toInputHandle
			            }
			        }), _v(_s(msg) + "\n\t")], 1)
			    }
			})

			(function anonymous() {
			    with(this) {
			        return _c('div', [_c('button', {
			            attrs: {
			                "type": "button"
			            },
			            on: {
			                "click": toEmit
			            }
			        },
			        [_v("emitChildData")])])
			    }
			})
		 */
		var bus = new Vue();
		var test = {
			template: `
        <div>
        	<button @click="toEmit" type="button">emitChildData</button>
        </div>
			`,
			data: function() {
				return {
					count: 0
				}
			},
			created() {
				console.log('components1')
				bus.$emit('to-input', 1)
			},
			mounted() {
				console.log('components2')
			},
			methods: {
				toEmit() {
					this.count++;
					this.$emit('to-input', this.count);
				}
			}
		}
		var app = new Vue({
			el: '#app',
			data: {
				msg: 'parent'
			},
			methods: {
				toInputHandle(val) {
					this.msg = val;
				}
			},
			created() {
				console.log('praent1')
				bus.$on('to-input', function() {
					alert(1)
				})
			},
			mounted() {
				console.log('praent2')
			},
			components: {
				test
			}
		})
	</script>
</body>
</html>